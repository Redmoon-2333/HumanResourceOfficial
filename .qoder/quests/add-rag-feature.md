# RAG功能设计文档

## 1. 功能概述

在现有的AI聊天助手基础上，集成RAG（检索增强生成）功能，通过Qdrant向量数据库提供基于校园生活知识库的智能问答能力，并支持Tool Calling实现数据库查询功能。

### 1.1 核心价值

- **知识增强**：为新生及在校生提供校园生活、学习、选课等全方位指导信息
- **上下文感知**：结合向量检索技术，提供更精准、相关的答复
- **数据防重**：通过MD5指纹机制避免向量数据库中的重复内容
- **功能扩展**：通过Tool Calling实现与现有数据库的联动查询（如部门成员信息）

### 1.2 适用场景

- 新生入学咨询（生活、饮食、出行）
- 学业规划指导（选课建议、学习方法）
- 人力资源中心部门信息查询
- 学生会历史成员查找

---

## 2. 技术架构设计

### 2.1 核心组件

#### 2.1.1 向量数据库层（Qdrant）

**部署方式**：
- 本地开发：使用本地Qdrant实例进行测试
- 生产环境：
  - 方案A：Docker容器化部署（推荐）
  - 方案B：直接在服务器上安装Qdrant服务

**连接方式**：
- 使用gRPC协议与Qdrant通信
- 配置连接参数：主机地址、端口、API密钥（如需要）

**Collection设计**：
- Collection名称：`campus_knowledge`
- 向量维度：根据所选嵌入模型确定（建议使用通义千问的Embedding API，维度为1536）
- 距离度量：Cosine相似度

**元数据结构**：

| 字段名称 | 数据类型 | 说明 | 示例 |
|---------|---------|------|------|
| content_md5 | string | 文档内容的MD5哈希值 | "a3d5e8f..." |
| file_name | string | 原始文件名 | "校园生活-饮食指南.txt" |
| category | string | 知识分类 | "生活指导" |
| subcategory | string | 知识子分类 | "饮食" |
| chunk_index | integer | 分块索引（用于长文档切分） | 0, 1, 2... |
| created_at | timestamp | 向量化时间戳 | "2024-01-15T10:30:00Z" |

#### 2.1.2 文档处理层

**支持的文件格式**：
- 第一阶段（必须）：纯文本文件（.txt）
- 第二阶段（可选）：Word文档（.docx）、PDF文件（.pdf）

**文档解析策略**：

| 文件类型 | 解析工具 | 处理流程 |
|---------|---------|---------|
| .txt | Java原生IO | 直接读取UTF-8编码文本 |
| .docx | Apache POI | 提取文本段落，过滤格式标记 |
| .pdf | Apache PDFBox | 提取文本内容，保留基本段落结构 |

**分词与分块策略**：
- 分块大小：500-800字符（基于语义完整性动态调整）
- 分块重叠：50-100字符（确保上下文连贯性）
- 分块边界：优先在段落、句子结束处切分
- 特殊处理：标题、列表、表格等结构化内容保持完整性

**MD5去重机制**：
1. 对每个分块的原始文本内容计算MD5哈希值
2. 在插入向量前查询Qdrant的metadata中是否存在相同MD5
3. 若存在则跳过该分块，若不存在则执行向量化并存储
4. 日志记录：记录跳过的重复内容数量及文件来源

#### 2.1.3 嵌入向量生成

**嵌入模型选择**：
- 使用通义千问Embedding API（text-embedding-v3）
- 向量维度：1536
- 批处理支持：单次请求最多处理25个文本块

**向量化流程**：
1. 文本预处理（去除多余空白符、规范化标点）
2. 调用通义千问Embedding API生成向量
3. 向量归一化（如需要）
4. 存储向量及关联的元数据到Qdrant

#### 2.1.4 检索增强组件

**检索参数配置**：

| 参数名称 | 默认值 | 说明 |
|---------|--------|------|
| top_k | 5 | 返回最相关的向量数量 |
| score_threshold | 0.7 | 相似度阈值（低于此值的结果被过滤） |
| search_type | hybrid | 混合搜索（向量+关键词） |

**检索流程**：
1. 用户问题向量化
2. 在Qdrant中执行语义相似度搜索
3. 根据score_threshold过滤低质量结果
4. 按相似度排序返回top_k个文档片段

**集成到ChatClient**：
```
使用Spring AI的RetrievalAugmentationAdvisor
- 构建VectorStoreDocumentRetriever，关联Qdrant向量存储
- 将advisor添加到ChatClient的advisors链中
- 在流式响应中自动注入检索到的上下文
```

### 2.2 Tool Calling功能设计

#### 2.2.1 工具定义

**工具1：查询部门成员信息**

| 属性 | 值 |
|-----|-----|
| 工具名称 | searchDepartmentMembers |
| 功能描述 | 根据姓名查询人力资源中心历史或当前成员信息 |
| 输入参数 | name（string）：成员姓名或姓名关键词 |
| 输出格式 | JSON数组，包含姓名、角色历史等信息 |

**工具2：查询往届成员列表**

| 属性 | 值 |
|-----|-----|
| 工具名称 | getAlumniByYear |
| 功能描述 | 获取指定年份或所有年份的往届成员信息 |
| 输入参数 | year（integer, optional）：年份，不传则返回所有 |
| 输出格式 | JSON对象，按年份分组的成员列表 |

#### 2.2.2 工具调用流程

```
用户提问 → AI识别需要调用工具 → 提取参数调用Java Service方法 → 返回查询结果 → AI整合结果生成自然语言回复
```

**错误处理策略**：
- 工具调用超时：3秒
- 数据库连接失败：返回友好错误信息
- 参数格式错误：提示正确的参数格式

---

## 3. 数据初始化方案

### 3.1 知识库目录结构

**文件组织形式**：
```
resources/
└── rag-knowledge-base/
    ├── 00-使用说明.txt
    ├── 01-校园生活/
    │   ├── 饮食/
    │   ├── 出行/
    │   ├── 住宿/
    │   └── 娱乐/
    ├── 02-学习指导/
    │   ├── 专业介绍/
    │   ├── 选课建议/
    │   ├── 学习方法/
    │   └── 考试技巧/
    ├── 03-职业发展/
    │   ├── 实习资源/
    │   ├── 职业规划/
    │   └── 求职指导/
    ├── 04-部门信息/
    │   ├── 人力资源中心简介/
    │   ├── 部门架构/
    │   └── 活动历史/
    └── 05-常见问题/
        ├── 行政事务/
        ├── 社团活动/
        └── 校园服务/
```

### 3.2 知识库内容框架模板

#### 3.2.1 校园生活类

**01-校园生活/饮食/食堂指南.txt**

内容框架：
- 各食堂位置及营业时间
- 特色窗口及推荐菜品
- 价格区间及支付方式
- 卫生评级及就餐高峰建议
- 外卖订餐平台及配送范围
- 特殊饮食需求（清真、素食）的解决方案

**01-校园生活/出行/校内交通.txt**

内容框架：
- 校园巴士线路及时刻表
- 共享单车使用规则及停放点
- 主要教学楼、宿舍区之间的步行路线
- 雨雪天气的出行建议
- 校门位置及进出管理规定

**01-校园生活/出行/校外交通.txt**

内容框架：
- 周边地铁站及公交线路
- 前往市中心的最优路线
- 出租车、网约车常用上车点
- 火车站、机场的交通接驳方案
- 节假日返乡购票建议

**01-校园生活/住宿/宿舍管理.txt**

内容框架：
- 宿舍楼分布及房型介绍
- 作息时间规定（门禁、熄灯）
- 用电安全及违禁物品清单
- 宿舍网络配置指南
- 维修报修流程
- 宿舍文化建设建议

**01-校园生活/娱乐/文体设施.txt**

内容框架：
- 图书馆、自习室分布及开放时间
- 体育场馆（篮球场、健身房、游泳池）使用规则
- 学生活动中心功能区介绍
- 社团活动报名及参与方式
- 校园文化活动日历

#### 3.2.2 学习指导类

**02-学习指导/专业介绍/计算机类专业.txt**

内容框架：
- 专业培养目标及核心课程
- 就业方向及行业前景
- 推荐阅读书籍及学习资源
- 学长学姐的学习经验分享

**02-学习指导/选课建议/通识课选课.txt**

内容框架：
- 通识课分类及学分要求
- 热门课程推荐（难度、收获、教师风格）
- 选课时间节点及抢课技巧
- 退课、补选的规则说明
- 跨专业选课的注意事项

**02-学习指导/选课建议/专业课选课.txt**

内容框架：
- 专业课程体系及修读顺序
- 必修课与选修课的平衡策略
- 课程难度评估及学习建议
- 先修课程要求说明

**02-学习指导/学习方法/时间管理.txt**

内容框架：
- 大学学习与高中学习的差异
- 制定学期学习计划的步骤
- 日常学习时间分配建议
- 应对拖延症的策略
- 效率工具推荐（日程管理、笔记软件）

**02-学习指导/学习方法/高效学习技巧.txt**

内容框架：
- 课堂笔记方法（康奈尔笔记法等）
- 复习记忆技巧（艾宾浩斯遗忘曲线）
- 小组学习的组织方式
- 利用网络资源自学的途径

**02-学习指导/考试技巧/期末备考.txt**

内容框架：
- 期末考试时间安排及复习周规划
- 历年试卷获取途径
- 重点章节识别方法
- 考前一周的冲刺策略
- 考试心态调整建议

#### 3.2.3 职业发展类

**03-职业发展/实习资源/实习信息渠道.txt**

内容框架：
- 校内实习信息发布平台
- 知名企业校招时间表
- 实习简历撰写要点
- 面试准备及常见问题
- 实习期间的注意事项

**03-职业发展/职业规划/大一至大四规划.txt**

内容框架：
- 大一：适应期目标（通识教育、兴趣探索）
- 大二：发展期目标（专业基础、技能提升）
- 大三：冲刺期目标（实习实践、竞赛科研）
- 大四：抉择期目标（考研、就业、出国准备）

**03-职业发展/求职指导/简历与面试.txt**

内容框架：
- 简历结构及内容要点
- 针对不同行业的简历定制
- 常见面试类型（行为面试、技术面试）
- 面试礼仪及着装建议
- Offer选择的决策因素

#### 3.2.4 部门信息类

**04-部门信息/人力资源中心简介.txt**

内容框架：
- 人力资源中心成立背景及使命
- 主要职能及服务对象
- 组织架构及部门分工
- 联系方式及办公地点
- 加入人力资源中心的流程

**04-部门信息/部门架构/部长与部员职责.txt**

内容框架：
- 部长的领导职责及任职要求
- 部员的日常工作及成长路径
- 部门例会制度及沟通机制
- 绩效考核及激励机制

**04-部门信息/活动历史/往年活动回顾.txt**

内容框架：
- 年度重点活动列表（时间、主题、规模）
- 活动策划经验总结
- 成功案例分析
- 改进建议及未来规划

#### 3.2.5 常见问题类

**05-常见问题/行政事务/学籍管理.txt**

内容框架：
- 学籍异动（转专业、休学、复学）流程
- 成绩查询及异议申诉
- 学生证、校园卡办理及挂失
- 各类证明材料的开具方式

**05-常见问题/社团活动/社团加入.txt**

内容框架：
- 社团招新时间及方式
- 如何选择适合自己的社团
- 社团活动的参与规则
- 社团干部竞选流程

**05-常见问题/校园服务/医疗与心理咨询.txt**

内容框架：
- 校医院位置及就诊流程
- 医保报销规定
- 心理咨询中心服务内容
- 预约咨询的方式及隐私保护

### 3.3 内容编写规范

#### 3.3.1 格式规范

- 文件编码：UTF-8
- 标题层级：使用"一、二、三"或"1. 2. 3."标记
- 段落分隔：段落之间使用空行
- 列表格式：使用"- "或"· "标记无序列表，使用"1. 2. 3."标记有序列表
- 重点标注：使用【】或加粗标记重要信息

#### 3.3.2 内容质量要求

- **准确性**：所有信息必须基于真实情况，避免过时或错误内容
- **完整性**：覆盖主题的关键方面，提供足够的细节
- **可读性**：语言简洁明了，避免过度学术化的表述
- **实用性**：提供可操作的建议，避免空洞的理论
- **更新机制**：注明内容的有效期，定期审核并更新

### 3.4 初始化执行流程

#### 3.4.1 手动批量导入方案

**步骤**：
1. 管理员将编写好的文档放入指定目录（如`/resources/rag-knowledge-base/`）
2. 通过管理接口触发初始化任务
3. 系统扫描目录下的所有支持格式文件
4. 依次执行：文件解析 → 分块 → MD5计算 → 去重检查 → 向量化 → 存储到Qdrant
5. 生成初始化报告：成功文件数、跳过的重复块数、失败的文件及原因

#### 3.4.2 增量更新方案

**触发方式**：
- 手动触发：管理员上传新文件后点击"同步知识库"按钮
- 定时任务：每日凌晨自动扫描目录变化并同步

**更新逻辑**：
- 新增文件：完整处理并添加到向量库
- 修改文件：删除旧版本的向量（通过file_name匹配），重新处理并添加
- 删除文件：标记为失效但不立即删除向量（保留历史查询能力）

---

## 4. 接口设计

### 4.1 向量数据库初始化接口

**接口路径**：`POST /api/rag/initialize`

**权限要求**：部长及以上角色

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| sourcePath | string | 是 | 知识库文件目录路径 |
| forceReindex | boolean | 否 | 是否强制重建索引（清空已有数据） |

**响应格式**：

```
{
  "code": 200,
  "message": "初始化成功",
  "data": {
    "totalFiles": 50,
    "processedFiles": 48,
    "failedFiles": 2,
    "totalChunks": 520,
    "newChunks": 500,
    "duplicateChunks": 20,
    "errors": [
      {
        "fileName": "文件名.pdf",
        "reason": "PDF解析失败"
      }
    ]
  }
}
```

### 4.2 RAG增强的聊天接口

**接口路径**：`POST /api/ai/chat-with-rag`

**权限要求**：部员及以上角色

**请求参数**：

| 参数名 | 类型 | 必填 | 说明 |
|-------|------|------|------|
| message | string | 是 | 用户消息 |
| useRAG | boolean | 否 | 是否启用RAG检索（默认true） |
| enableTools | boolean | 否 | 是否启用Tool Calling（默认true） |

**响应格式**（流式）：

```
data: {"type": "chunk", "content": "根据"}
data: {"type": "chunk", "content": "校园"}
data: {"type": "chunk", "content": "生活"}
...
data: {"type": "done"}
```

### 4.3 知识库管理接口

**接口1：查询知识库统计**

- 路径：`GET /api/rag/stats`
- 权限：部员及以上
- 返回：文档总数、向量总数、分类统计、最后更新时间

**接口2：增量同步知识库**

- 路径：`POST /api/rag/sync`
- 权限：部长及以上
- 功能：扫描目录变化并增量更新向量库

**接口3：删除指定文档向量**

- 路径：`DELETE /api/rag/document/{fileName}`
- 权限：部长及以上
- 功能：从向量库中删除指定文件的所有向量

---

## 5. 数据流转设计

### 5.1 知识初始化流程

```
[Mermaid流程图]
文件上传 → 文件格式识别 → 文本提取 → 分块处理 → MD5计算 → 去重检查 → 向量化 → Qdrant存储 → 返回结果
```

**详细步骤说明**：

1. **文件扫描**：递归遍历知识库目录，识别所有支持格式的文件
2. **格式识别**：根据文件扩展名调用对应的解析器
3. **文本提取**：
   - TXT：直接读取全文
   - DOCX：使用Apache POI提取段落
   - PDF：使用PDFBox按页提取并合并
4. **分块处理**：
   - 按500-800字符切分
   - 在段落或句子边界处切分
   - 保留50-100字符的重叠
5. **MD5计算**：对每个分块的原始文本计算哈希值
6. **去重检查**：在Qdrant中查询metadata.content_md5字段
7. **向量化**：调用通义千问Embedding API生成1536维向量
8. **存储**：将向量及metadata写入Qdrant的campus_knowledge集合

### 5.2 RAG检索流程

```
[Mermaid流程图]
用户提问 → 问题向量化 → Qdrant语义搜索 → 结果过滤与排序 → 上下文拼接 → ChatClient处理 → 流式输出
```

**详细步骤说明**：

1. **问题向量化**：将用户问题通过Embedding API转换为向量
2. **语义搜索**：
   - 在Qdrant中执行向量相似度搜索
   - 设置top_k=5，返回最相关的5个文档片段
   - 应用score_threshold=0.7，过滤低相关性结果
3. **结果处理**：
   - 按相似度分数排序
   - 提取文档内容及元数据
   - 生成上下文摘要
4. **上下文注入**：
   - 通过RetrievalAugmentationAdvisor将检索到的文档注入到Prompt
   - 格式化为"以下是相关知识库内容：[内容1][内容2]..."
5. **生成回复**：ChatClient基于用户问题+检索上下文生成答案
6. **流式输出**：通过SSE逐字符返回给前端

### 5.3 Tool Calling流程

```
[Mermaid流程图]
用户提问 → AI意图识别 → 工具选择 → 参数提取 → Java Service调用 → 结果返回 → 自然语言整合 → 流式输出
```

**详细步骤说明**：

1. **意图识别**：AI判断问题是否需要调用数据库工具
2. **工具选择**：从可用工具列表中选择合适的工具
3. **参数提取**：从问题中提取工具所需的参数（如姓名、年份）
4. **Service调用**：
   - searchDepartmentMembers：调用UserService.searchUsersByNameLike()
   - getAlumniByYear：调用UserService.getAlumniMembers()并过滤年份
5. **结果整合**：AI将结构化数据转换为自然语言描述
6. **流式返回**：与普通回复一致，通过SSE输出

---

## 6. 依赖配置

### 6.1 Maven依赖清单

```
需要在pom.xml中添加的依赖：

1. Qdrant Java客户端
   - groupId: io.qdrant
   - artifactId: client
   - version: 1.9.1

2. gRPC依赖
   - io.grpc:grpc-netty-shaded:1.58.0
   - io.grpc:grpc-protobuf:1.58.0
   - io.grpc:grpc-stub:1.58.0

3. 文档解析依赖（可选）
   - Apache POI（Word）：org.apache.poi:poi-ooxml:5.2.5
   - PDFBox（PDF）：org.apache.pdfbox:pdfbox:2.0.30

4. Spring AI VectorStore
   - 检查是否需要额外的spring-ai-qdrant-store依赖
   - 或直接使用Qdrant客户端手动实现VectorStore接口
```

### 6.2 配置参数设计

**application.yml配置示例**：

```
配置项结构：

qdrant:
  host: localhost（开发环境）或 服务器IP（生产环境）
  port: 6334
  api-key: ${QDRANT_API_KEY:}（可选，如启用认证）
  collection-name: campus_knowledge
  
rag:
  knowledge-base-path: /resources/rag-knowledge-base/
  chunk-size: 800
  chunk-overlap: 100
  embedding-model: text-embedding-v3
  retrieval-top-k: 5
  score-threshold: 0.7
  
tool-calling:
  enabled: true
  timeout-seconds: 3
```

---

## 7. 部署方案

### 7.1 Qdrant部署

**方案A：Docker部署（推荐）**

步骤：
1. 拉取Qdrant官方镜像
2. 创建数据持久化目录
3. 启动容器并映射端口（6333 HTTP，6334 gRPC）
4. 配置防火墙规则允许访问
5. 验证连接状态

**方案B：服务器直接安装**

步骤：
1. 下载Qdrant二进制文件
2. 配置系统服务（systemd）
3. 设置数据存储路径
4. 启动服务并设置开机自启
5. 配置反向代理（可选）

### 7.2 向量数据库初始化

**初次部署步骤**：
1. 将编写好的知识库文件打包并上传到服务器
2. 解压到指定目录（如`/home/hrofficial/rag-knowledge-base/`）
3. 通过管理接口触发初始化任务
4. 监控日志确认处理进度
5. 验证向量数据是否正确存储

**后续更新步骤**：
1. 将新增或修改的文件上传到知识库目录
2. 调用增量同步接口
3. 查看同步报告确认更新状态

---

## 8. 监控与优化

### 8.1 性能监控指标

| 指标名称 | 监控方式 | 告警阈值 |
|---------|---------|---------|
| 向量检索延迟 | 日志记录每次检索耗时 | 超过500ms |
| Embedding API调用耗时 | 日志记录调用时长 | 超过2秒 |
| 向量库连接状态 | 健康检查接口 | 连接失败 |
| 知识库文档数量 | 定时统计 | 无新增超过7天 |
| 工具调用成功率 | 统计成功/失败次数 | 成功率低于95% |

### 8.2 优化策略

**检索优化**：
- 缓存热门问题的检索结果
- 调整top_k和score_threshold参数以平衡准确率和召回率
- 使用过滤器（filter）缩小搜索范围（如仅搜索特定分类）

**向量化优化**：
- 批量调用Embedding API减少网络开销
- 对长文本预先做摘要再向量化
- 使用异步任务处理大批量文档初始化

**成本优化**：
- 监控Embedding API调用次数，避免重复向量化
- 定期清理无效或低质量的向量数据
- 评估是否需要本地部署开源嵌入模型

---

## 9. 风险与应对

### 9.1 技术风险

| 风险项 | 影响 | 应对措施 |
|-------|------|---------|
| Qdrant服务不稳定 | 检索功能失效 | 降级策略：禁用RAG，回退到纯LLM模式 |
| Embedding API限流 | 初始化失败或检索缓慢 | 实现请求队列及重试机制 |
| 文档解析错误 | 知识库不完整 | 日志记录失败文件，人工修复后重新导入 |
| 向量数据损坏 | 查询结果异常 | 定期备份Qdrant数据，支持快速恢复 |

### 9.2 业务风险

| 风险项 | 影响 | 应对措施 |
|-------|------|---------|
| 知识库内容过时 | 用户获取错误信息 | 建立内容审核机制，标注内容有效期 |
| 敏感信息泄露 | 隐私安全问题 | 在文档审核阶段过滤敏感信息 |
| 用户滥用工具调用 | 数据库负载过高 | 限制工具调用频率，记录异常调用日志 |

---

## 10. 验收标准

### 10.1 功能验收

- [ ] 成功部署Qdrant并创建Collection
- [ ] 能够解析TXT文件并向量化存储
- [ ] MD5去重机制有效，重复文档不会被重复添加
- [ ] 用户提问后能检索到相关知识并生成回复
- [ ] Tool Calling能正确调用部门成员查询功能
- [ ] 管理接口能触发初始化和增量同步

### 10.2 性能验收

- [ ] 单次检索延迟 < 500ms（在top_k=5的情况下）
- [ ] 支持至少50个文档、500个向量片段的知识库规模
- [ ] 并发10个用户同时查询不出现明显延迟

### 10.3 易用性验收

- [ ] 知识库编写人员无需技术背景即可添加内容
- [ ] 初始化报告清晰展示成功/失败情况
- [ ] 前端用户能明显感知RAG回复与普通回复的质量差异

---

## 11. 开发任务分解建议

### 11.1 第一阶段：基础架构搭建

**任务清单**：
1. 添加Maven依赖（Qdrant、gRPC）
2. 创建Qdrant配置类及连接管理
3. 实现VectorStore接口或封装Qdrant客户端
4. 配置application.yml参数

**负责人建议**：后端开发1人，预计2-3天

### 11.2 第二阶段：文档处理与向量化

**任务清单**：
1. 实现TXT文件解析器
2. 实现文本分块逻辑
3. 集成通义千问Embedding API
4. 实现MD5去重检查
5. 编写向量存储逻辑

**负责人建议**：后端开发1-2人，预计3-4天

### 11.3 第三阶段：RAG检索集成

**任务清单**：
1. 配置RetrievalAugmentationAdvisor
2. 修改AIChatService支持RAG模式
3. 创建新的Controller接口
4. 测试检索效果并调优参数

**负责人建议**：后端开发1人，预计2-3天

### 11.4 第四阶段：Tool Calling实现

**任务清单**：
1. 定义工具Schema（JSON格式）
2. 在ChatClient中注册工具
3. 实现工具调用的参数解析
4. 连接UserService方法
5. 测试工具调用流程

**负责人建议**：后端开发1人，预计2天

### 11.5 第五阶段：知识库内容编写

**任务清单**：
1. 根据框架模板编写校园生活类文档
2. 编写学习指导类文档
3. 编写职业发展类文档
4. 编写部门信息类文档
5. 编写常见问题类文档
6. 内容审核与校对

**负责人建议**：部门成员协作，每人负责1-2个主分类，预计7-10天

### 11.6 第六阶段：管理接口与前端对接

**任务清单**：
1. 开发初始化、同步、统计接口
2. 前端新增RAG开关组件
3. 前端适配Tool Calling结果展示
4. 编写接口文档

**负责人建议**：后端1人+前端1人，预计2-3天

### 11.7 第七阶段：测试与优化

**任务清单**：
1. 单元测试（文档解析、分块、向量化）
2. 集成测试（端到端RAG流程）
3. 性能测试（并发检索、大批量初始化）
4. 参数调优（chunk_size、top_k、threshold）
5. 用户验收测试

**负责人建议**：全体成员参与，预计3-5天

---

## 12. 附录

### 12.1 相关技术文档链接

- Qdrant官方文档：https://qdrant.tech/documentation/
- Spring AI文档：https://docs.spring.io/spring-ai/reference/
- 通义千问Embedding API：https://help.aliyun.com/zh/dashscope/
- Apache POI文档：https://poi.apache.org/
- PDFBox文档：https://pdfbox.apache.org/

### 12.2 知识库内容编写示例

**示例文件：01-校园生活/饮食/食堂指南.txt**

```
【校园食堂完整指南】

一、主要食堂介绍

1. 第一食堂（东区）
- 位置：东区宿舍楼1号楼旁
- 营业时间：早餐6:30-9:00，午餐10:30-13:00，晚餐16:30-19:00
- 特色窗口：川湘风味、清真餐厅、素食窗口
- 推荐菜品：红烧肉（15元）、麻辣香锅（18-25元）、素菜套餐（8元）
- 价格区间：人均12-20元

2. 第二食堂（西区）
- 位置：西区图书馆对面
- 营业时间：与第一食堂相同
- 特色：粤式早茶、面食专区、甜品站
- 推荐：肠粉（10元）、拉面（12元）、双皮奶（6元）
- 价格区间：人均10-18元

二、支付方式
- 校园卡（可享受补贴，比现金优惠5%）
- 支付宝、微信扫码
- 云闪付

三、就餐建议
- 高峰期：12:00-12:30、18:00-18:30，建议错峰就餐
- 雨雪天：建议提前打包或使用外卖服务
- 特殊饮食：清真餐厅位于第一食堂二楼，素食窗口每日提供5-6种菜品

四、外卖配送
- 美团、饿了么均可配送至宿舍楼下
- 配送时间：11:00-13:30、17:00-20:00
- 配送费：3-5元，满20元起送
```

### 12.3 术语表

| 术语 | 解释 |
|-----|------|
| RAG | Retrieval-Augmented Generation，检索增强生成 |
| Embedding | 文本嵌入向量，将文本转换为高维数值向量 |
| Qdrant | 开源向量数据库，支持高效的语义搜索 |
| Tool Calling | AI模型调用外部工具（如数据库查询）的能力 |
| Chunk | 文档分块，将长文档切分为小片段以便向量化 |
| MD5 | 消息摘要算法，用于生成内容的唯一指纹 |
| gRPC | 高性能的RPC框架，Qdrant使用其进行通信 |
| SSE | Server-Sent Events，服务器推送事件，用于流式响应 || gRPC | 高性能的RPC框架，Qdrant使用其进行通信 |
