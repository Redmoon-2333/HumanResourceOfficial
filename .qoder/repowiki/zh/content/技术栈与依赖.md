# 技术栈与依赖

<cite>
**本文档引用的文件**
- [pom.xml](file://pom.xml)
- [application.yml](file://src\main\resources\application.yml)
- [SecurityConfig.java](file://src\main\java\com\redmoon2333\config\SecurityConfig.java)
- [JwtAuthenticationFilter.java](file://src\main\java\com\redmoon2333\config\JwtAuthenticationFilter.java)
- [OssConfig.java](file://src\main\java\com\redmoon2333\config\OssConfig.java)
- [JwtUtil.java](file://src\main\java\com\redmoon2333\util\JwtUtil.java)
- [AuthService.java](file://src\main\java\com\redmoon2333\service\AuthService.java)
- [AuthController.java](file://src\main\java\com\redmoon2333\controller\AuthController.java)
- [User.java](file://src\main\java\com\redmoon2333\entity\User.java)
- [UserMapper.java](file://src\main\java\com\redmoon2333\mapper\UserMapper.java)
- [UserMapper.xml](file://src\main\resources\mapper\UserMapper.xml)
- [WebConfig.java](file://src\main\java\com\redmoon2333\config\WebConfig.java)
</cite>

## 目录
1. [项目概述](#项目概述)
2. [核心技术栈](#核心技术栈)
3. [依赖分析](#依赖分析)
4. [技术架构概览](#技术架构概览)
5. [配置详解](#配置详解)
6. [安全架构](#安全架构)
7. [数据持久化](#数据持久化)
8. [文件存储](#文件存储)
9. [性能优化](#性能优化)
10. [部署考虑](#部署考虑)

## 项目概述

HumanResourceOfficial是一个基于Spring Boot构建的人力资源管理系统，采用现代化的企业级Java技术栈。该项目专为高校校友会组织设计，提供了完整的用户认证、权限管理、活动管理和文件存储功能。

项目采用微服务化的架构思想，通过模块化设计实现了高内聚低耦合的代码结构。系统支持多角色权限控制，具备完善的用户生命周期管理，以及高效的文件上传和存储功能。

## 核心技术栈

### Spring Boot 3.1.4

Spring Boot作为项目的核心框架，提供了快速开发和自动配置的能力：

```mermaid
graph TB
subgraph "Spring Boot生态系统"
SB[Spring Boot 3.1.4]
WS[spring-boot-starter-web]
SS[spring-boot-starter-security]
MS[spring-boot-starter-validation]
MP[sagination Helper]
AS[spring-boot-starter-aop]
JPA[spring-boot-starter-data-jpa]
REDIS[spring-boot-starter-data-redis]
end
SB --> WS
SB --> SS
SB --> MS
SB --> MP
SB --> AS
SB --> JPA
SB --> REDIS
```

**图表来源**
- [pom.xml](file://pom.xml#L18-L40)

### Java 17运行环境

项目选择Java 17作为基础运行环境，充分利用了现代JDK的新特性：

- **性能提升**：Java 17带来了显著的性能改进
- **安全性增强**：长期支持版本确保安全更新
- **语言特性**：支持模式匹配、密封类等现代Java特性
- **容器友好**：优化的容器化支持

### MyBatis 3.0.2

MyBatis作为ORM框架，提供了灵活的数据访问层：

- **SQL灵活性**：支持复杂的SQL查询
- **XML映射**：清晰的SQL语句分离
- **动态SQL**：强大的条件判断能力
- **缓存机制**：一级和二级缓存优化

**章节来源**
- [pom.xml](file://pom.xml#L22-L24)
- [UserMapper.java](file://src\main\java\com\redmoon2333\mapper\UserMapper.java#L1-L78)
- [UserMapper.xml](file://src\main\resources\mapper\UserMapper.xml#L1-L106)

## 依赖分析

### Spring生态组件

#### spring-boot-starter-web
- **版本**：3.1.4
- **用途**：提供Web应用的基础功能，包括嵌入式Tomcat服务器
- **特点**：自动配置、开箱即用、RESTful支持

#### spring-boot-starter-security
- **版本**：3.1.4
- **用途**：提供企业级安全解决方案
- **功能**：认证、授权、CSRF防护、会话管理

#### spring-boot-starter-validation
- **版本**：3.1.4
- **用途**：提供Bean Validation支持
- **特点**：JSR-380规范、注解驱动验证

#### spring-boot-starter-data-jpa
- **版本**：3.1.4
- **用途**：简化JPA数据访问
- **功能**：实体管理、事务管理、查询DSL

#### spring-boot-starter-aop
- **版本**：3.1.4
- **用途**：面向切面编程支持
- **应用**：权限校验、日志记录、异常处理

### 第三方库

#### MyBatis Spring Boot Starter 3.0.2
- **用途**：MyBatis与Spring Boot的集成
- **优势**：自动配置、类型转换、事务管理

#### JWT处理库 0.11.5
- **用途**：JSON Web Token处理
- **组件**：
  - jjwt-api：核心API定义
  - jjwt-impl：实现库
  - jjwt-jackson：Jackson序列化支持

#### PageHelper 1.4.6
- **用途**：分页插件
- **特点**：无侵入式、支持多种数据库
- **配置**：MySQL方言、合理分页、方法参数支持

#### 阿里云OSS SDK 3.17.2
- **用途**：对象存储服务SDK
- **功能**：文件上传、下载、删除、管理
- **优势**：高可用、分布式存储、CDN加速

#### Redis支持
- **spring-boot-starter-data-redis**：Redis客户端支持
- **commons-pool2**：连接池管理
- **用途**：缓存、会话存储、分布式锁

**章节来源**
- [pom.xml](file://pom.xml#L18-L50)

## 技术架构概览

```mermaid
graph TB
subgraph "表现层"
AC[AuthController]
UC[UserController]
MC[MaterialController]
PC[ActivityController]
end
subgraph "业务层"
AS[AuthService]
US[UserService]
MS[MaterialService]
PS[ActivityService]
end
subgraph "数据访问层"
UM[UserMapper]
MM[MaterialMapper]
AM[ActivityMapper]
CM[CommonMapper]
end
subgraph "基础设施"
SC[SecurityConfig]
JF[JwtAuthenticationFilter]
OC[OssConfig]
JU[JwtUtil]
end
subgraph "外部服务"
DB[(MySQL数据库)]
OSS[阿里云OSS]
REDIS[(Redis缓存)]
end
AC --> AS
UC --> US
MC --> MS
PC --> PS
AS --> UM
US --> UM
MS --> MM
PS --> AM
AS --> JU
JF --> JU
UM --> DB
MM --> DB
AM --> DB
CM --> DB
OC --> OSS
JU --> REDIS
```

**图表来源**
- [AuthController.java](file://src\main\java\com\redmoon2333\controller\AuthController.java#L1-L153)
- [AuthService.java](file://src\main\java\com\redmoon2333\service\AuthService.java#L1-L199)
- [SecurityConfig.java](file://src\main\java\com\redmoon2333\config\SecurityConfig.java#L1-L131)

## 配置详解

### 数据源配置

项目使用MySQL作为主数据库，配置了详细的连接参数：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/hrofficial?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=GMT%2B8&allowPublicKeyRetrieval=true
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
```

**配置要点**：
- **字符集设置**：UTF-8确保中文支持
- **时区配置**：GMT+8适应中国时区
- **SSL禁用**：简化开发环境配置
- **公钥检索**：解决MySQL 8.0的兼容性问题

### MyBatis配置

```yaml
mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: com.redmoon2333.entity
```

**配置说明**：
- **映射文件位置**：classpath:mapper/*.xml
- **类型别名**：自动扫描实体包
- **XML映射**：分离SQL语句，提高可维护性

### 分页配置

```yaml
pagehelper:
  helper-dialect: mysql
  reasonable: true
  support-methods-arguments: true
  params: count=countSql
```

**配置特点**：
- **MySQL方言**：针对MySQL优化
- **合理分页**：防止越界访问
- **方法参数**：支持复杂查询参数
- **计数优化**：独立的COUNT SQL

### Redis配置

```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password: 
      timeout: 10000ms
      database: 0
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0
```

**配置要点**：
- **连接池**：Lettuce连接池优化
- **超时设置**：10秒超时保证响应性
- **数据库隔离**：使用独立数据库避免冲突

**章节来源**
- [application.yml](file://src\main\resources\application.yml#L1-L62)

## 安全架构

### Spring Security集成

系统采用Spring Security提供全面的安全保障：

```mermaid
sequenceDiagram
participant Client as 客户端
participant Filter as JWT过滤器
participant Security as 安全配置
participant Service as 业务服务
participant DB as 数据库
Client->>Filter : 发送请求(带JWT)
Filter->>Filter : 验证Authorization头
Filter->>Filter : 提取JWT令牌
Filter->>Filter : 验证令牌有效性
Filter->>Filter : 解析用户身份
Filter->>Security : 设置安全上下文
Security->>Service : 转发请求
Service->>DB : 数据操作
DB-->>Service : 返回结果
Service-->>Security : 处理结果
Security-->>Client : 返回响应
```

**图表来源**
- [JwtAuthenticationFilter.java](file://src\main\java\com\redmoon2333\config\JwtAuthenticationFilter.java#L1-L137)
- [SecurityConfig.java](file://src\main\java\com\redmoon2333\config\SecurityConfig.java#L1-L131)

### JWT认证流程

JWT认证是系统的核心安全机制：

```mermaid
flowchart TD
Start([用户登录]) --> ValidateCreds["验证用户名密码"]
ValidateCreds --> CredsValid{"凭据有效?"}
CredsValid --> |否| LoginFail["登录失败"]
CredsValid --> |是| GenToken["生成JWT令牌"]
GenToken --> StoreRedis["存储到Redis"]
StoreRedis --> SetBlacklist["设置黑名单检查"]
SetBlacklist --> ReturnToken["返回令牌给客户端"]
ReturnToken --> End([认证完成])
LoginFail --> End
```

**图表来源**
- [AuthService.java](file://src\main\java\com\redmoon2333\service\AuthService.java#L35-L50)
- [JwtUtil.java](file://src\main\java\com\redmoon2333\util\JwtUtil.java#L40-L60)

### 权限控制机制

系统实现了基于角色的历史权限控制：

```java
// 权限解析示例
List<SimpleGrantedAuthority> authorities = new ArrayList<>();
if (roleHistory != null && !roleHistory.trim().isEmpty()) {
    String[] roles = roleHistory.split("&");
    for (String role : roles) {
        role = role.trim();
        if (role.contains("部长")) {
            authorities.add(new SimpleGrantedAuthority("ROLE_MINISTER"));
        }
        if (role.contains("部员")) {
            authorities.add(new SimpleGrantedAuthority("ROLE_MEMBER"));
        }
        // 年级权限
        if (role.contains("2024级")) {
            authorities.add(new SimpleGrantedAuthority("ROLE_2024"));
        }
    }
}
```

**权限层次**：
- **ROLE_USER**：默认用户权限
- **ROLE_MINISTER**：部长权限
- **ROLE_MEMBER**：部员权限
- **年级权限**：2021级至2024级

### CORS配置

系统配置了灵活的跨域资源共享策略：

```java
configuration.setAllowedOriginPatterns(Arrays.asList(
    "http://localhost:3000",
    "http://localhost:8081", 
    "http://127.0.0.1:3000",
    "http://127.0.0.1:8081",
    "http://localhost:8080",
    "http://127.0.0.1:8080",
    // Docker环境支持
    "http://hrofficial-backend:8080",
    "http://backend:8080",
    // 生产环境域名
    "https://yourdomain.com",
    "https://www.yourdomain.com",
    // 允许任何https协议的域名
    "https://*"
));
```

**章节来源**
- [SecurityConfig.java](file://src\main\java\com\redmoon2333\config\SecurityConfig.java#L25-L60)
- [JwtAuthenticationFilter.java](file://src\main\java\com\redmoon2333\config\JwtAuthenticationFilter.java#L45-L85)

## 数据持久化

### MyBatis映射设计

系统采用MyBatis作为ORM框架，实现了清晰的数据访问层：

```mermaid
classDiagram
class UserMapper {
+findById(Integer userId) User
+findByUsername(String username) User
+findByName(String name) User[]
+findByNameLike(String name) User[]
+countByUsername(String username) int
+insert(User user) int
+update(User user) int
+deleteById(Integer userId) int
+selectAll() User[]
}
class User {
+Integer userId
+String username
+String password
+String name
+String roleHistory
+getUserId() Integer
+setUserId(Integer userId) void
+getUsername() String
+setUsername(String username) void
+getPassword() String
+setPassword(String password) void
+getName() String
+setName(String name) void
+getRoleHistory() String
+setRoleHistory(String roleHistory) void
}
class UserMapperXml {
+BaseResultMap ResultMap
+Base_Column_List SqlFragment
+findById Select
+findByUsername Select
+findByName Select
+findByNameLike Select
+countByUsername Select
+selectAll Select
+insert Insert
+update Update
+deleteById Delete
}
UserMapper --> User : "操作"
UserMapper --> UserMapperXml : "映射"
UserMapperXml --> User : "映射"
```

**图表来源**
- [UserMapper.java](file://src\main\java\com\redmoon2333\mapper\UserMapper.java#L1-L78)
- [User.java](file://src\main\java\com\redmoon2333\entity\User.java#L1-L99)
- [UserMapper.xml](file://src\main\resources\mapper\UserMapper.xml#L1-L106)

### 数据库表设计

系统使用MySQL数据库，主要实体包括：

```sql
CREATE TABLE user (
    user_id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(20) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    name VARCHAR(50),
    role_history LONGTEXT
);

CREATE TABLE activation_code (
    code_id INT AUTO_INCREMENT PRIMARY KEY,
    code VARCHAR(16) NOT NULL UNIQUE,
    creator_id INT NOT NULL,
    expire_time DATETIME NOT NULL,
    create_time DATETIME NOT NULL,
    status ENUM('未使用', '已使用') NOT NULL,
    user_id INT DEFAULT NULL,
    use_time DATETIME DEFAULT NULL
);
```

### 分页查询

系统使用PageHelper实现高效的分页查询：

```java
// 分页查询示例
PageHelper.startPage(pageNum, pageSize);
List<User> userList = userMapper.selectAll();
PageInfo<User> pageInfo = new PageInfo<>(userList);
```

**分页特性**：
- **无侵入性**：无需修改现有SQL
- **多数据库支持**：自动适配不同数据库
- **性能优化**：独立的COUNT查询

**章节来源**
- [UserMapper.java](file://src\main\java\com\redmoon2333\mapper\UserMapper.java#L1-L78)
- [UserMapper.xml](file://src\main\resources\mapper\UserMapper.xml#L1-L106)

## 文件存储

### 阿里云OSS集成

系统集成了阿里云OSS作为文件存储解决方案：

```mermaid
classDiagram
class OssConfig {
-String endpoint
-String accessKeyId
-String accessKeySecret
-String bucketName
-OSS ossClient
+ossClient() OSS
+getBucketName() String
+destroy() void
}
class OssUtil {
+uploadFile(String fileName, InputStream inputStream) String
+downloadFile(String objectName) InputStream
+deleteFile(String objectName) boolean
+getFileUrl(String objectName) String
}
class OSS {
+putObject(PutObjectRequest request) PutObjectResult
+getObject(GetObjectRequest request) OSSObject
+deleteObject(String bucketName, String key) void
+generatePresignedUrl(String bucketName, String key, Date expiration) URL
}
OssConfig --> OSS : "创建"
OssUtil --> OSS : "使用"
```

**图表来源**
- [OssConfig.java](file://src\main\java\com\redmoon2333\config\OssConfig.java#L1-L71)

### OSS配置管理

```java
@Configuration
@ConditionalOnExpression("'${aliyun.oss.accessKeyId:}' != '' && '${aliyun.oss.accessKeySecret:}' != ''")
public class OssConfig {
    
    @Value("${aliyun.oss.endpoint:oss-cn-hangzhou.aliyuncs.com}")
    private String endpoint;
    
    @Value("${aliyun.oss.accessKeyId:}")
    private String accessKeyId;
    
    @Value("${aliyun.oss.accessKeySecret:}")
    private String accessKeySecret;
    
    @Value("${aliyun.oss.bucketName:}")
    private String bucketName;
}
```

**配置特点**：
- **条件加载**：只有在配置完整时才创建客户端
- **默认值**：提供合理的默认配置
- **环境变量**：支持通过环境变量配置
- **资源管理**：实现DisposableBean接口确保资源释放

### 文件上传流程

```mermaid
sequenceDiagram
participant Client as 客户端
participant Controller as 控制器
participant Service as 服务层
participant OSS as 阿里云OSS
participant DB as 数据库
Client->>Controller : 上传文件请求
Controller->>Controller : 验证文件大小和类型
Controller->>Service : 处理文件上传
Service->>Service : 生成文件名
Service->>OSS : 上传文件到OSS
OSS-->>Service : 返回文件URL
Service->>DB : 保存文件元数据
DB-->>Service : 确认保存
Service-->>Controller : 返回文件信息
Controller-->>Client : 返回上传结果
```

**章节来源**
- [OssConfig.java](file://src\main\java\com\redmoon2333\config\OssConfig.java#L1-L71)

## 性能优化

### Redis缓存策略

系统使用Redis作为缓存层，提升性能：

```yaml
# Redis连接池配置
spring:
  data:
    redis:
      lettuce:
        pool:
          max-active: 8
          max-wait: -1ms
          max-idle: 8
          min-idle: 0
```

**缓存应用场景**：
- **JWT令牌存储**：防止重复验证
- **用户信息缓存**：减少数据库查询
- **权限缓存**：快速权限检查
- **热点数据**：活跃用户信息

### 数据库优化

```yaml
# MySQL连接池优化
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
```

### 分页优化

PageHelper配置优化了分页性能：

```yaml
pagehelper:
  helper-dialect: mysql
  reasonable: true
  support-methods-arguments: true
  params: count=countSql
```

**优化效果**：
- **合理分页**：防止越界访问
- **方法参数**：支持复杂查询
- **独立计数**：优化COUNT查询性能

## 部署考虑

### Docker支持

项目提供了完整的Docker部署方案：

```dockerfile
FROM openjdk:17-jdk-slim
COPY target/HumanResourceOfficial-1.0-SNAPSHOT.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","/app.jar"]
```

### 部署脚本

项目包含多个部署脚本：

- **deploy.sh**：Linux环境部署脚本
- **deploy.bat**：Windows环境部署脚本  
- **docker-compose.yml**：容器编排配置
- **nginx.conf**：反向代理配置

### 环境配置

系统支持多环境配置：

```bash
# 开发环境
export SPRING_PROFILES_ACTIVE=dev
export ALIYUN_OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com

# 生产环境
export SPRING_PROFILES_ACTIVE=prod
export ALIYUN_OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com
export DATABASE_URL=jdbc:mysql://prod-db:3306/hrofficial
```

### 监控配置

```yaml
logging:
  level:
    com.redmoon2333.service.UserService: DEBUG
    com.redmoon2333.service.PastActivityService: INFO
    com.redmoon2333.controller.PastActivityController: INFO
    root: INFO
```

**监控要点**：
- **服务级别**：不同服务设置不同日志级别
- **调试信息**：关键服务启用DEBUG级别
- **性能监控**：INFO级别记录重要操作
- **根级别**：统一的日志级别控制

**章节来源**
- [application.yml](file://src\main\resources\application.yml#L55-L62)

## 总结

HumanResourceOfficial项目采用了现代化的企业级Java技术栈，通过精心的技术选型和架构设计，实现了高性能、高可靠性的HR管理系统。项目的主要技术亮点包括：

1. **Spring Boot生态**：完整的Spring生态系统，提供开箱即用的功能
2. **安全架构**：基于JWT的无状态认证，配合Spring Security实现细粒度权限控制
3. **数据持久化**：MyBatis + MySQL组合，兼顾灵活性和性能
4. **文件存储**：阿里云OSS提供高可用的文件存储服务
5. **性能优化**：Redis缓存、分页优化、连接池配置等全方位性能提升
6. **部署友好**：Docker支持、多环境配置、自动化部署脚本

这套技术栈不仅满足了当前的功能需求，也为未来的扩展和维护奠定了坚实的基础。通过模块化的设计和清晰的职责分离，系统具备了良好的可维护性和可扩展性。